<VirtualHost *:443>
    ServerName ocf.io
    ServerAdmin help@ocf.berkeley.edu

    SSLEngine on
    SSLCertificateFile /etc/ssl/private/ocf.io.crt
    SSLCertificateKeyFile /etc/ssl/private/ocf.io.key
    SSLCertificateChainFile /etc/ssl/certs/positivessl-intermediate.crt
    Include ssl-common.conf

    # Short URLs
    # Remember to add these to the list of RESERVED_USERNAMES in ocflib/constants.py
    RewriteEngine on
    RewriteRule ^/?$ https://www.ocf.berkeley.edu/ [R=301]
    RewriteRule ^/about$ https://www.ocf.berkeley.edu/docs/about/ [R]
    RewriteRule ^/account$ https://www.ocf.berkeley.edu/docs/services/account/ [R]
    RewriteRule ^/contact$ https://www.ocf.berkeley.edu/docs/contact/ [R]
    RewriteRule ^/docs(/.*)?$ https://www.ocf.berkeley.edu/docs$1 [R]
    RewriteRule ^/email-update$ http://status.ocf.berkeley.edu/2014/06/email-discontinuation-update-forward.html [R]
    RewriteRule ^/faq$ https://www.ocf.berkeley.edu/docs/faq/ [R]
    RewriteRule ^/join$ https://accounts.ocf.berkeley.edu/request-account [R]
    RewriteRule ^/lab$ https://www.ocf.berkeley.edu/docs/services/lab/ [R]
    RewriteRule ^/mon$ http://munin.ocf.berkeley.edu/ [R]
    RewriteRule ^/password$ https://accounts.ocf.berkeley.edu/change-password [R]
    RewriteRule ^/rt$ https://rt.ocf.berkeley.edu/ [R]
    RewriteRule ^/rt/([0-9]+)$ https://rt.ocf.berkeley.edu/Ticket/Display.html?id=$1 [R]
    RewriteRule ^/servers$ https://www.ocf.berkeley.edu/docs/staff/backend/servers/ [R]
    RewriteRule ^/ssh$ https://www.ocf.berkeley.edu/docs/services/shell/ [R]
    RewriteRule ^/staff$ http://hello.ocf.berkeley.edu/ [R]
    RewriteRule ^/staff-hours$ https://www.ocf.berkeley.edu/staff-hours [R]
    RewriteRule ^/staff_hours$ https://ocf.io/staff-hours [R]
    RewriteRule ^/stats$ https://www.ocf.berkeley.edu/stats/ [R]
    RewriteRule ^/status$ http://status.ocf.berkeley.edu/ [R]
    RewriteRule ^/vhost$ https://www.ocf.berkeley.edu/docs/services/vhost/ [R]
    RewriteRule ^/wiki$ https://www.ocf.berkeley.edu/docs/ [R]
    RewriteRule ^/wordpress$ https://www.ocf.berkeley.edu/docs/services/web/wordpress/ [R]
    RewriteRule ^/https$ http://status.ocf.berkeley.edu/2014/10/moving-wwwocfberkeleyedu-to-https-only.html [R]
    RewriteRule ^/apphost$ http://status.ocf.berkeley.edu/2014/10/announcing-dedicated-hosting-for-web.html [R]
    RewriteRule ^/mysql$ https://www.ocf.berkeley.edu/docs/services/mysql/ [R]
    RewriteRule ^/hosting$ https://www.ocf.berkeley.edu/docs/services/web/ [R]
    RewriteRule ^/web$ https://www.ocf.berkeley.edu/docs/services/web/ [R]
    RewriteRule ^/callinkapi$ https://studentservices.berkeley.edu/WebServices/StudentGroupServiceV2/Service.asmx/CalLinkOrganizations [R]
    RewriteRule ^/mlk$ https://www.ocf.berkeley.edu/mlk [R]

    # otherwise, send a temporary redirect to the appropriate userdir
    RewriteRule ^/~?([a-z]{3,8}(?:/.*)?)$ https://www.ocf.berkeley.edu/~$1 [R=302]

    Header set Strict-Transport-Security "max-age=31536000"
</VirtualHost>

# redirect http aliases to https version so we can enable HSTS (for next time)
<VirtualHost *:80>
    ServerName ocf.io
    ServerAlias ocf.sexy open.cf
    ServerAdmin help@ocf.berkeley.edu

    Redirect 301 / https://ocf.io/
</VirtualHost>
