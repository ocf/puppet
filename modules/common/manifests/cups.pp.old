class common::cups {

  # install cups
  package { [ 'cups', 'cups-bsd' ]: }

  file {
    # provide config
    '/opt/share/puppet/cups':
      ensure  => directory,
      require => Class['common::puppet'];
    '/etc/cups/printers.conf':
      path    => '/opt/share/puppet/cups/printers.conf',
      source  => 'puppet:///modules/common/cups/printers.conf',
      require => File['/opt/share/puppet/cups'];
    # provide custom ppd files for double and single
    '/etc/cups/ppd':
      path    => '/opt/share/puppet/cups/ocf.ppd',
      source  => 'puppet:///modules/common/cups/ocf.ppd',
      require => File['/opt/share/puppet/cups'];
    # set default printer double
    '/etc/cups/lpoptions':
      content => 'Default double',
      require => Package[ 'cups', 'cups-bsd' ];
    # provide setup script
    'cups':
      source  => 'puppet:///modules/common/cups/setup.sh',
      path    => '/opt/share/puppet/cups/setup.sh',
      mode    => 0755,
      require => File['/opt/share/puppet/cups'];
  }

  # run cups setup script
  exec { 'cups':
    command     => '/opt/share/puppet/cups/setup.sh',
    refreshonly => true,
    subscribe   => File[ '/etc/cups/printers.conf', '/etc/cups/ppd', '/etc/cups/lpoptions', 'cups' ],
    require     => Package[ 'cups', 'cups-bsd' ]
  }

  # set default paper size
  file { '/etc/papersize':
    content => 'letter'
  }

}
